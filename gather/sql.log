select p._Genotype_key, count(1) as pair_count
		into temp table genotype_pair_counts
		from gxd_allelepair p
		where exists (select 1 from voc_annot v
			where v._AnnotType_key in (1002,1005)
			and v._Term_key != 293594
			and v._Object_key = p._Genotype_key)
		group by p._Genotype_key
||
create index q1 on genotype_pair_counts(_Genotype_key)
||
select count(1) from genotype_pair_counts
||
select distinct gpc._Genotype_key, gag._Allele_key
		into temp table tmp_allele_genotype
		from genotype_pair_counts gpc,
			gxd_allelegenotype gag
		where gpc._Genotype_key = gag._Genotype_key
			and gpc.pair_count < 2
||
create index q2a on tmp_allele_genotype(_Genotype_key)
||
create index q2b on tmp_allele_genotype(_Allele_key)
||
select count(1) from tmp_allele_genotype
||
select distinct gag._Genotype_key, 
			gag._Allele_key, 
			gag._Marker_key,
			gg.isConditional,
			0 as hasEC,
			0 as isRecombinase
		into temp table genotype_allele_marker
		from gxd_allelegenotype gag,
			all_allele aa,
			gxd_genotype gg,
			genotype_pair_counts gpc
		where gag._Genotype_key = gpc._Genotype_key
			and gag._Genotype_key = gg._Genotype_key
			and gag._Allele_key = aa._Allele_key
			and aa.isWildType = 0
			and gpc.pair_count > 1
||
create index q3a on genotype_allele_marker(_Genotype_key)
||
create index q3b on genotype_allele_marker(_Allele_key)
||
create index q3c on genotype_allele_marker(_Marker_key)
||
select count(1) from genotype_allele_marker
||
update genotype_allele_marker
		set hasEC = 1
		where _Allele_key in (select _Object_key_1
			from mgi_relationship
			where _Category_key = 1004)
||
select count(1) from genotype_allele_marker where hasEC = 1
||
update genotype_allele_marker
		set isRecombinase = 1
		where _Allele_key in (select _Object_key
			from voc_annot
			where _AnnotType_key = 1014
				and _Term_key = 11025588)
||
select count(1) from genotype_allele_marker where isRecombinase = 1
||
delete from genotype_allele_marker
		where isRecombinase = 1
			and hasEC = 0
||
select count(1) from genotype_allele_marker
||
select _Genotype_key,
			count(distinct _Marker_key) as marker_count
		into temp table genotype_marker_counts
		from genotype_allele_marker
		group by _Genotype_key
||
select count(1) from genotype_marker_counts
||
insert into tmp_allele_genotype
		select distinct gmc._Genotype_key, gam._Allele_key
		from genotype_marker_counts gmc,
			genotype_allele_marker gam
		where gmc._Genotype_key = gam._Genotype_key
			and gmc.marker_count = 1
||
select count(1) from tmp_allele_genotype
||

                create index idx_snp_mrk_key on tmp_allele_genotype (_genotype_key)
        
||

	select tag._allele_key,
		vah.isNormal,
		ms.synonym as header,
		vah._term_key
	from tmp_allele_genotype tag,
		VOC_AnnotHeader vah,
		VOC_Term vt,
		MGI_Synonym ms,
		MGI_SynonymType mst
	where tag._Genotype_key = vah._Object_key
		AND vah._Term_key = vt._Term_key
		AND vah._AnnotType_key = 1002
		AND vt._Term_key = ms._Object_key
		AND ms._SynonymType_key = mst._SynonymType_key
		AND mst._MGIType_key = 13 
		AND mst.synonymType = 'Synonym Type 2'
	
||

	select tag._allele_key,
		vt.term,
		aa.accID omimId,
		vt._term_key
	from tmp_allele_genotype tag,
		VOC_Annot va,
		VOC_Term vt,
		ACC_Accession aa,
		VOC_Term vq
	where tag._Genotype_key = va._Object_key
		AND va._Qualifier_key = vq._Term_key
		AND vq.term IS null
		AND va._Term_key = vt._Term_key
		AND va._AnnotType_key = 1005
		AND vt._Term_key = aa._Object_key
		AND aa._MGIType_key = 13 
		AND aa.preferred = 1
		AND aa.private = 0
	
||

	select _allele_key,_genotype_key
	from tmp_allele_genotype tag
	
||

	select a._allele_key
	from all_allele a
	where exists (select 1 from gxd_allelegenotype gag,
			voc_annotheader vah,
			voc_term vt
		where gag._genotype_key=vah._object_key
			and vah._term_key=vt._term_key
			and vah._annottype_key= 1002
			and vah.isnormal=0
			and vt.term!='normal phenotype'
			and gag._allele_key=a._allele_key)
	
||
